#!/bin/bash
# Script de nettoyage radical pour node_modules et caches
# Usage : bash cleanup_node_modules.sh

set -e

# Ferme tous les serveurs Node.js/Vite éventuels
if pgrep -f "node|vite|npm|yarn" > /dev/null; then
  echo "[INFO] Arrête tous les serveurs Node.js/Vite/React avant de continuer !"
  echo "Appuie sur Ctrl+C pour annuler ou Entrée pour continuer."
  read
fi

# Suppression ciblée des dossiers bloquants connus
for d in node_modules/cssesc node_modules/bcryptjs node_modules/viem\ 2; do
  if [ -d "$d" ]; then
    echo "[INFO] Suppression forcée de $d ..."
    sudo rm -rf "$d"
  fi

done

# Suppression complète des modules, caches et locks
sudo rm -rf node_modules .vite .next .turbo package-lock.json yarn.lock pnpm-lock.yaml

echo "[INFO] Nettoyage terminé. Tu peux relancer : npm install --legacy-peer-deps"
